name: Test Server Connection

on:
  workflow_dispatch:

jobs:
  test-connection:
    runs-on: ubuntu-latest
    timeout-minutes: 5

    steps:
    - name: Test SSH Connection
      uses: appleboy/ssh-action@v1.0.3
      with:
        host: ${{ secrets.SERVER_HOST }}
        username: ${{ secrets.SERVER_USER }}
        key: ${{ secrets.SERVER_SSH_KEY }}
        port: ${{ secrets.SERVER_PORT || 22 }}
        timeout: 30s
        script: |
          echo "✅ SSH connection successful!"
          echo "Server: $(hostname)"
          echo "User: $(whoami)"
          echo "Date: $(date)"
          echo "Uptime: $(uptime)"
          
          # Verificar si Docker está instalado
          if command -v docker &> /dev/null; then
            echo "✅ Docker is installed: $(docker --version)"
          else
            echo "❌ Docker is not installed"
          fi
          
          # Verificar si docker-compose está instalado
          if command -v docker-compose &> /dev/null; then
            echo "✅ Docker Compose is installed: $(docker-compose --version)"
          else
            echo "❌ Docker Compose is not installed"
          fi
          
          # Verificar directorio del proyecto
          if [ -d "/opt/pollos-chanchos-Angular" ]; then
            echo "✅ Project directory exists"
            ls -la /opt/pollos-chanchos-Angular/
          else
            echo "❌ Project directory does not exist"
            echo "Available directories in /opt/:"
            ls -la /opt/ || echo "Cannot access /opt/"
          fi
