name: Test Server Connection

on:
  workflow_dispatch:

jobs:
  test-connection:
    runs-on: ubuntu-latest
    timeout-minutes: 5

    steps:
    - name: Debug Connection Info
      run: |
        echo "üîç Debugging SSH connection..."
        echo "Server Host: ${{ secrets.SERVER_HOST }}"
        echo "Server User: ${{ secrets.SERVER_USER }}"
        echo "Server Port: ${{ secrets.SERVER_PORT || 22 }}"
        
    - name: Test SSH Connection
      uses: appleboy/ssh-action@v1.0.3
      with:
        host: ${{ secrets.SERVER_HOST }}
        username: ${{ secrets.SERVER_USER }}
        key: ${{ secrets.SERVER_SSH_KEY }}
        port: ${{ secrets.SERVER_PORT || 22 }}
        timeout: 30s
        command_timeout: 60s
        debug: true
        script: |
          echo "‚úÖ SSH connection successful!"
          echo "Server: $(hostname)"
          echo "User: $(whoami)"
          echo "Date: $(date)"
          echo "Uptime: $(uptime)"
          
          # Verificar si Docker est√° instalado
          if command -v docker &> /dev/null; then
            echo "‚úÖ Docker is installed: $(docker --version)"
          else
            echo "‚ùå Docker is not installed"
          fi
          
          # Verificar si docker-compose est√° instalado
          if command -v docker-compose &> /dev/null; then
            echo "‚úÖ Docker Compose is installed: $(docker-compose --version)"
          else
            echo "‚ùå Docker Compose is not installed"
          fi
          
          # Verificar directorio del proyecto
          if [ -d "/opt/pollos-chanchos-Angular" ]; then
            echo "‚úÖ Project directory exists"
            ls -la /opt/pollos-chanchos-Angular/
          else
            echo "‚ùå Project directory does not exist"
            echo "Available directories in /opt/:"
            ls -la /opt/ || echo "Cannot access /opt/"
          fi
