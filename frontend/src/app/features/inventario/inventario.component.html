<div class="p-6 bg-white rounded-lg shadow-md">
  <!-- Encabezado -->
  <div class="text-center mb-6">
    <h1 class="text-3xl font-bold text-blue-800">Gestión de Inventario</h1>
    <p class="text-gray-600 mt-2">Administra los productos e insumos del sistema avícola</p>
  </div>

<!-- Vista de Alertas -->
<div *ngIf="vistaActual === 'alertas'" class="space-y-6">
  <div class="bg-white border border-gray-200 rounded-lg p-6 shadow-sm">
    <div class="flex items-center justify-between mb-4">
      <h2 class="text-xl font-semibold text-gray-800">
        <i class="fas fa-bell text-yellow-500 mr-2"></i>Alertas de Vencimiento
      </h2>
      <div class="flex items-center space-x-2">
        <label class="text-sm text-gray-700">Días:</label>
        <input type="number" class="w-24 p-2 border border-gray-300 rounded-md" [(ngModel)]="diasAlertaPorVencer">
        <button (click)="cargarAlertasEntradas(diasAlertaPorVencer)" class="px-3 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700">
          <i class="fas fa-sync-alt mr-1"></i>Actualizar
        </button>
      </div>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
      <!-- Por Vencer -->
      <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4">
        <h3 class="text-lg font-semibold text-yellow-800 mb-3">
          <i class="fas fa-hourglass-half mr-2"></i>Por vencer (≤ {{ diasAlertaPorVencer }} días)
        </h3>
        <div class="overflow-x-auto">
          <table class="min-w-full divide-y divide-gray-200">
            <thead class="bg-gray-50">
              <tr>
                <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Producto</th>
                <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Lote</th>
                <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Vence</th>
                <th class="px-3 py-2 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Stock base</th>
              </tr>
            </thead>
            <tbody class="bg-white divide-y divide-gray-200">
              <tr *ngFor="let e of alertasPorVencer">
                <td class="px-3 py-2">{{ e.product?.name || 'Producto' }}</td>
                <td class="px-3 py-2">{{ e.codigoLote || '-' }}</td>
                <td class="px-3 py-2">{{ e.fechaVencimiento | date:'dd/MM/yyyy' }}</td>
                <td class="px-3 py-2 text-right">{{ e.stockBaseRestante || 0 | number:'1.0-2' }}</td>
              </tr>
              <tr *ngIf="alertasPorVencer.length === 0">
                <td colspan="4" class="px-3 py-3 text-center text-sm text-gray-500">Sin alertas por vencer</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>

      <!-- Vencidas -->
      <div class="bg-red-50 border border-red-200 rounded-lg p-4">
        <h3 class="text-lg font-semibold text-red-800 mb-3">
          <i class="fas fa-times-circle mr-2"></i>Vencidas
        </h3>
        <div class="overflow-x-auto">
          <table class="min-w-full divide-y divide-gray-200">
            <thead class="bg-gray-50">
              <tr>
                <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Producto</th>
                <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Lote</th>
                <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Venció</th>
                <th class="px-3 py-2 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Stock base</th>
              </tr>
            </thead>
            <tbody class="bg-white divide-y divide-gray-200">
              <tr *ngFor="let e of alertasVencidas">
                <td class="px-3 py-2">{{ e.product?.name || 'Producto' }}</td>
                <td class="px-3 py-2">{{ e.codigoLote || '-' }}</td>
                <td class="px-3 py-2">{{ e.fechaVencimiento | date:'dd/MM/yyyy' }}</td>
                <td class="px-3 py-2 text-right">{{ e.stockBaseRestante || 0 | number:'1.0-2' }}</td>
              </tr>
              <tr *ngIf="alertasVencidas.length === 0">
                <td colspan="4" class="px-3 py-3 text-center text-sm text-gray-500">Sin entradas vencidas</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>

      <!-- Stock Bajo -->
      <div class="bg-white border border-orange-200 rounded-lg p-4">
        <h3 class="text-lg font-semibold text-orange-800 mb-3">
          <i class="fas fa-exclamation-triangle mr-2 text-orange-600"></i>Stock bajo
          <span class="ml-2 text-sm text-orange-600" *ngIf="inventariosStockBajo?.length">({{ inventariosStockBajo.length }})</span>
        </h3>
        <div class="overflow-x-auto">
          <table class="min-w-full divide-y divide-gray-200">
            <thead class="bg-gray-50">
              <tr>
                <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Tipo/Producto</th>
                <th class="px-3 py-2 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Actual</th>
                <th class="px-3 py-2 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Mínimo</th>
              </tr>
            </thead>
            <tbody class="bg-white divide-y divide-gray-200">
              <tr *ngFor="let item of inventariosStockBajo">
                <td class="px-3 py-2">
                  {{ item?.tipoAlimento?.name || 'Producto' }}
                </td>
                <td class="px-3 py-2 text-right">
                  <span class="text-red-700 font-semibold">{{ item.cantidadStock | number:'1.0-2' }}</span>
                  <span class="text-gray-500 text-xs ml-1">{{ item.unidadMedida }}</span>
                </td>
                <td class="px-3 py-2 text-right">
                  <span class="text-gray-800">{{ item.stockMinimo | number:'1.0-2' }}</span>
                  <span class="text-gray-500 text-xs ml-1">{{ item.unidadMedida }}</span>
                </td>
              </tr>
              <tr *ngIf="!inventariosStockBajo || inventariosStockBajo.length === 0">
                <td colspan="3" class="px-3 py-3 text-center text-sm text-gray-500">Sin ítems con stock bajo</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</div>
  
  <!-- Navegación entre vistas -->
  <div class="flex justify-center mb-6">
    <div class="bg-gray-100 rounded-lg p-1">
      <button 
        (click)="cambiarVista('productos')" 
        [class]="vistaActual === 'productos' ? 'bg-blue-500 text-white' : 'text-gray-600'"
        class="px-4 py-2 rounded-md transition-colors duration-200 font-medium">
        <i class="fas fa-boxes mr-2"></i>Productos
      </button>
      <button 
        (click)="cambiarVista('inventario-automatico')" 
        [class]="vistaActual === 'inventario-automatico' ? 'bg-blue-500 text-white' : 'text-gray-600'"
        class="px-4 py-2 rounded-md transition-colors duration-200 font-medium">
        <i class="fas fa-warehouse mr-2"></i>Inventario Automático
      </button>
      <button 
        (click)="cambiarVista('entradas')" 
        [class]="vistaActual === 'entradas' ? 'bg-blue-500 text-white' : 'text-gray-600'"
        class="px-4 py-2 rounded-md transition-colors duration-200 font-medium">
        <i class="fas fa-inbox mr-2"></i>Entradas
      </button>
      <button 
        (click)="cambiarVista('alertas')" 
        [class]="vistaActual === 'alertas' ? 'bg-blue-500 text-white' : 'text-gray-600'"
        class="px-4 py-2 rounded-md transition-colors duration-200 font-medium">
        <i class="fas fa-bell mr-2"></i>Alertas
      </button>
      
      
    </div>
  </div>

 

  <!-- Vista de Productos (existente) -->
  <div *ngIf="vistaActual === 'productos'">
  
  <!-- Indicador de carga -->
  <div *ngIf="isLoading" class="flex justify-center my-4">
    <div class="animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500"></div>
  </div>
  
  <!-- Panel de búsqueda/filtros -->
  <div class="bg-blue-50 p-4 rounded-lg border border-blue-100 mb-6">
    <h2 class="text-lg font-medium text-blue-800 mb-3">Filtros de búsqueda</h2>
    <form [formGroup]="searchForm" (ngSubmit)="searchProducts()" class="grid grid-cols-1 md:grid-cols-3 gap-4">
      <div class="space-y-1">
        <label class="text-sm font-medium text-gray-700">Nombre</label>
        <input type="text" formControlName="name" class="w-full p-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500" placeholder="Buscar por nombre...">
      </div>
      
      <div class="space-y-1">
        <label class="text-sm font-medium text-gray-700">Proveedor</label>
        <select formControlName="providerId" class="w-full p-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500">
          <option [ngValue]="null">Todos</option>
          <option *ngFor="let provider of providers" [value]="provider.id">{{ provider.name }}</option>
        </select>
      </div>
      
      <div class="space-y-1">
        <label class="text-sm font-medium text-gray-700">Tipo de Alimento</label>
        <select formControlName="typeFoodId" class="w-full p-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500">
          <option [ngValue]="null">Todos</option>
          <option *ngFor="let typeFood of typeFoods" [value]="typeFood.id">{{ typeFood.name }}</option>
        </select>
      </div>
      
      <div class="space-y-1">
        <label class="text-sm font-medium text-gray-700">Animal</label>
        <select formControlName="animalId" class="w-full p-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500">
          <option [ngValue]="null">Todos</option>
          <option *ngFor="let animal of animals" [value]="animal.id">{{ animal.name }}</option>
        </select>
      </div>
      
      <div class="space-y-1">
        <label class="text-sm font-medium text-gray-700">Etapa</label>
        <select formControlName="stageId" class="w-full p-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500">
          <option [ngValue]="null">Todos</option>
          <option *ngFor="let stage of stages" [value]="stage.id">{{ stage.name }}</option>
        </select>
      </div>
      
      <div class="flex items-end space-x-2">
        <button type="submit" class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors">
          Buscar
        </button>
        <button type="button" (click)="resetFilters()" class="px-4 py-2 bg-gray-200 text-gray-700 rounded-md hover:bg-gray-300 transition-colors">
          Limpiar
        </button>
      </div>
    </form>
  </div>
  
  <!-- Panel principal de productos -->
  <div class="mb-6">
    <div class="flex justify-between items-center mb-4">
      <h2 class="text-xl font-semibold text-blue-800">Listado de Productos</h2>
      <div class="flex items-center space-x-2">
        <button 
          (click)="actualizarProductosYStock()" 
          class="bg-blue-600 hover:bg-blue-700 text-white px-3 py-2 rounded-lg transition-colors duration-300 shadow-sm flex items-center">
          <i class="fas fa-sync-alt mr-2"></i> Actualizar
        </button>
        <button 
          (click)="sincronizarInventario()" 
          class="bg-purple-600 hover:bg-purple-700 text-white px-3 py-2 rounded-lg transition-colors duration-300 shadow-sm flex items-center">
          <i class="fas fa-link mr-2"></i> Sincronizar inventario
        </button>
        <button 
          (click)="openForm(false)" 
          class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg transition-colors duration-300 shadow-sm flex items-center">
          <span class="mr-1">+</span> Nuevo Producto
        </button>
      </div>
    </div>
    
    <!-- Tabla de productos -->
    <div class="overflow-x-auto bg-white rounded-lg shadow">
      <table class="min-w-full divide-y divide-gray-200">
        <thead class="bg-gray-50">
          <tr>
            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Nombre</th>
            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Cantidad</th>
            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Cantidad Real</th>
            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Disminución</th>
            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Precio Unitario</th>
            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Fecha Compra</th>
            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Tipo Alimento</th>
            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Animal</th>
            <th class="px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">Acciones</th>
          </tr>
        </thead>
        <tbody class="bg-white divide-y divide-gray-200">
          <tr *ngIf="filteredProducts.length === 0 && !isLoading" class="hover:bg-gray-50">
            <td colspan="9" class="px-4 py-4 text-center text-sm text-gray-500">No se encontraron productos</td>
          </tr>
          <tr *ngFor="let product of filteredProducts" class="hover:bg-gray-50">
            <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-900">{{ product.name }}</td>
            <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-600">{{ getStockTotalProducto(product) | number:'1.0-2' }}</td>
            <!-- Cantidad Real (proporcional por tipo) -->
            <td class="px-4 py-3 whitespace-nowrap text-sm font-semibold" [ngClass]="{'text-green-700': getCantidadRealProducto(product) > 0, 'text-red-700': getCantidadRealProducto(product) === 0}">{{ getCantidadRealProducto(product) | number:'1.0-2' }}</td>
            <!-- Disminución real -->
            <td class="px-4 py-3 whitespace-nowrap text-sm text-orange-700 font-semibold">
              {{ getDisminucionProducto(product) | number:'1.0-2' }}
            </td>
            <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-600">{{ product.price_unit | currency:'USD':'symbol':'1.2-2' }}</td>
            <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-600">
              {{ product.date_compra ? (toDate(product.date_compra) | date:'dd/MM/yyyy') : '-' }}
            </td>
            <!-- Tipo de Alimento -->
            <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-600">
              {{ product.typeFood?.name || getTypeFoodName(product.typeFood_id) }}
            </td>
            <!-- Animal -->
            <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-600">
              {{ product.animal?.name || getAnimalName(product.animal_id) }}
            </td>
            <td class="px-4 py-3 whitespace-nowrap text-sm text-center">
              <div class="flex justify-center space-x-2">
                <button *ngIf="getCantidadRealProducto(product) === 0"
                  (click)="reponerProducto(product)" 
                  class="px-2 py-1 text-xs bg-green-600 text-white rounded hover:bg-green-700"
                  title="Crear entrada vigente (FEFO)">
                  Reponer
                </button>
                <button 
                  (click)="openForm(true, product)" 
                  class="text-blue-600 hover:text-blue-900 p-1 rounded hover:bg-blue-100 transition-colors">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
                  </svg>
                </button>
                <button 
                  (click)="deleteProduct(product.id)" 
                  class="text-red-600 hover:text-red-900 p-1 rounded hover:bg-red-100 transition-colors">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                  </svg>
                </button>
              </div>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
  
  <!-- Modal de formulario -->
  <div *ngIf="showForm" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
    <div class="bg-white rounded-lg shadow-xl w-full max-w-4xl max-h-screen overflow-y-auto">
      <div class="p-6">
        <div class="flex justify-between items-center mb-4">
          <h3 class="text-xl font-semibold text-gray-900">
            {{ isEditMode ? 'Editar Producto' : 'Nuevo Producto' }}
          </h3>
          <button (click)="closeForm()" class="text-gray-500 hover:text-gray-700">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
            </svg>
          </button>
        </div>
        
        <form [formGroup]="productForm" (ngSubmit)="saveProduct()" class="space-y-4">
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <!-- COLUMNA 1 - Según la imagen -->
            <div class="space-y-4">
              <!-- Nombre -->
              <div class="space-y-1">
                <label class="text-sm font-medium text-gray-700">Nombre *</label>
                <select formControlName="name" class="w-full p-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500">
                  <option [ngValue]="''">Seleccione un nombre</option>
                  <option *ngFor="let np of nombreProductos" [value]="np.nombre">
                    {{ np.nombre }}
                  </option>
                </select>
                <div *ngIf="productForm.get('name')?.invalid && productForm.get('name')?.touched" class="text-sm text-red-600">
                  Este campo es requerido
                </div>
              </div>
              <div class="space-y-1">
                <label class="text-sm font-medium text-gray-700">Descripción</label>
                <textarea formControlName="description" rows="2" class="w-full p-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500" placeholder="Descripción del producto"></textarea>
              </div>
              
              <!-- Tipo de Alimento -->
              <div class="space-y-1">
                <label class="text-sm font-medium text-gray-700">Tipo de Alimento *</label>
                <select formControlName="typeFood_id" class="w-full p-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500">
                  <option [ngValue]="null">Seleccione un tipo</option>
                  <option *ngFor="let typeFood of typeFoods" [value]="typeFood.id">{{ typeFood.name }}</option>
                </select>
                <div *ngIf="productForm.get('typeFood_id')?.invalid && productForm.get('typeFood_id')?.touched" class="text-sm text-red-600">
                  Este campo es requerido
                </div>
              </div>
              
              <!-- Cantidad -->
              <div class="space-y-1">
                <label class="text-sm font-medium text-gray-700">Cantidad *</label>
                <input type="number" formControlName="quantity" class="w-full p-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500" placeholder="Cantidad">
                <div *ngIf="productForm.get('quantity')?.invalid && productForm.get('quantity')?.touched" class="text-sm text-red-600">
                  Este campo es requerido
                </div>
              </div>
              
              <!-- Precio Unitario -->
              <div class="space-y-1">
                <label class="text-sm font-medium text-gray-700">Precio Unitario *</label>
                <input type="number" step="0.01" formControlName="price_unit" class="w-full p-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500" placeholder="Precio unitario">
                <div *ngIf="productForm.get('price_unit')?.invalid && productForm.get('price_unit')?.touched" class="text-sm text-red-600">
                  Este campo es requerido
                </div>
              </div>
              
              <!-- Fecha de Compra -->
              <div class="space-y-1">
                <label class="text-sm font-medium text-gray-700">Fecha de Compra</label>
                <input type="date" formControlName="date_compra" class="w-full p-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500">
              </div>
              
              <!-- Nivel Mínimo -->
              <div class="space-y-1">
                <label class="text-sm font-medium text-gray-700">Nivel Mínimo</label>
                <input type="number" step="0.01" formControlName="level_min" class="w-full p-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500" placeholder="Nivel mínimo">
              </div>
            </div>
            
            <!-- COLUMNA 2 - Según la imagen -->
            <div class="space-y-4">
              <!-- Animal -->
              <div class="space-y-1">
                <label class="text-sm font-medium text-gray-700">Animal *</label>
                <select formControlName="animal_id" class="w-full p-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500">
                  <option [ngValue]="null">Seleccione un animal</option>
                  <option *ngFor="let animal of animals" [value]="animal.id">{{ animal.name }}</option>
                </select>
                <div *ngIf="productForm.get('animal_id')?.invalid && productForm.get('animal_id')?.touched" class="text-sm text-red-600">
                  Este campo es requerido
                </div>
              </div>
              
              <!-- Etapa -->
              <div class="space-y-1">
                <label class="text-sm font-medium text-gray-700">Etapa *</label>
                <select formControlName="stage_id" class="w-full p-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500">
                  <option [ngValue]="null">Seleccione una etapa</option>
                  <option *ngFor="let stage of stages" [value]="stage.id">{{ stage.name }}</option>
                </select>
                <div *ngIf="productForm.get('stage_id')?.invalid && productForm.get('stage_id')?.touched" class="text-sm text-red-600">
                  Este campo es requerido
                </div>
              </div>
              
              <!-- Unidad de Medida -->
              <div class="space-y-1">
                <label class="text-sm font-medium text-gray-700">Unidad de Medida *</label>
                <select formControlName="unitMeasurement_id" class="w-full p-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500">
                  <option [ngValue]="null">Seleccione una unidad</option>
                  <option *ngFor="let unit of unitMeasurements" [value]="unit.id">{{ unit.name }}</option>
                </select>
                <div *ngIf="productForm.get('unitMeasurement_id')?.invalid && productForm.get('unitMeasurement_id')?.touched" class="text-sm text-red-600">
                  Este campo es requerido
                </div>
              </div>
              
              <!-- Número de Factura -->
              <div class="space-y-1">
                <label class="text-sm font-medium text-gray-700">Número de Factura</label>
                <input type="number" formControlName="number_facture" class="w-full p-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500" placeholder="Número de factura">
              </div>
              
              <!-- Proveedor -->
              <div class="space-y-1">
                <label class="text-sm font-medium text-gray-700">Proveedor *</label>
                <select formControlName="provider_id" class="w-full p-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500">
                  <option [ngValue]="null">Seleccione un proveedor</option>
                  <option *ngFor="let provider of providers" [value]="provider.id">{{ provider.name }}</option>
                </select>
                <div *ngIf="productForm.get('provider_id')?.invalid && productForm.get('provider_id')?.touched" class="text-sm text-red-600">
                  Este campo es requerido
                </div>
              </div>
              
              <!-- Nivel Máximo -->
              <div class="space-y-1">
                <label class="text-sm font-medium text-gray-700">Nivel Máximo</label>
                <input type="number" step="0.01" formControlName="level_max" class="w-full p-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500" placeholder="Nivel máximo">
              </div>
            </div>
          </div>
          
          <div class="flex justify-end space-x-3 mt-6">
            <button type="button" (click)="closeForm()" class="px-4 py-2 bg-gray-200 text-gray-700 rounded-md hover:bg-gray-300 transition-colors">
              Cancelar
            </button>
            <button type="submit" [disabled]="productForm.invalid" class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors disabled:bg-gray-400 disabled:cursor-not-allowed">
              {{ isEditMode ? 'Actualizar' : 'Guardar' }}
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

</div> <!-- Fin de la vista de productos -->

<!-- Vista de Entradas -->
<div *ngIf="vistaActual === 'entradas'">
  <div class="space-y-6">
    <div class="bg-white border border-gray-200 rounded-lg p-6 shadow-sm">
      <h2 class="text-xl font-semibold text-gray-800 mb-4">
        <i class="fas fa-inbox mr-2 text-blue-600"></i>Registrar Entradas por Producto
      </h2>
      <!-- Nota explicativa: Unidad de control vs Unidad base -->
      <div class="mb-4 p-3 rounded-md border border-blue-200 bg-blue-50 text-blue-800 text-sm">
        <div class="flex items-start">
          <i class="fas fa-info-circle mt-0.5 mr-2"></i>
          <div>
            <p class="font-semibold">Unidad de control vs Unidad de medida (base)</p>
            <p>
              La <strong>Unidad de control</strong> es el empaque (saco, frasco, caja, etc.).
              Los <strong>cálculos de stock</strong> se hacen en la <strong>unidad base</strong> del producto
              (kg, g, L, ml), usando <em>Contenido por unidad (base)</em> × <em>Cantidad de unidades</em>.
              Por ejemplo: 10 sacos de 40&nbsp;kg = 400&nbsp;kg.
            </p>
          </div>
        </div>
      </div>
      <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
        <div>
          <label class="text-sm font-medium text-gray-700">Producto</label>
          <select class="w-full p-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500" 
                  [ngModel]="selectedProductIdEntradas" 
                  (ngModelChange)="onProductoEntradasChange($event)">
            <option [ngValue]="null">Seleccione un producto</option>
            <option *ngFor="let p of products" [ngValue]="p.id">{{ p.name }}</option>
          </select>
        </div>
        <div>
          <label class="text-sm font-medium text-gray-700">Unidad de control</label>
          <input type="text" list="unidadesControlLista" class="w-full p-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500" [formControl]="entradaForm.get('unidadControl')" placeholder="Ej.: saco, frasco, caja">
          <datalist id="unidadesControlLista">
            <option value="saco"></option>
            <option value="bolsa"></option>
            <option value="caja"></option>
            <option value="frasco"></option>
            <option value="sobre"></option>
            <option value="bidón"></option>
            <option value="balde"></option>
            <option value="galón"></option>
            <option value="quintal"></option>
            <option value="unidad"></option>
          </datalist>
        </div>
        <div class="flex items-end">
          <button (click)="selectedProductIdEntradas && cargarEntradasPorProducto(selectedProductIdEntradas)" class="px-4 py-2 bg-gray-200 text-gray-700 rounded-md hover:bg-gray-300">Refrescar</button>
        </div>
      </div>

      <!-- Resumen del inventario del producto seleccionado (por producto) -->
      <div *ngIf="invProductoSeleccionado" class="mb-4 p-4 border rounded-lg bg-gray-50">
        <div class="flex items-center justify-between">
          <div>
            <h3 class="text-base font-semibold text-gray-800">{{ invProductoSeleccionado.product?.name }}</h3>
            <p class="text-sm text-gray-600">Unidad base: {{ invProductoSeleccionado.unidadMedida || getUnidadBaseProducto(selectedProductIdEntradas) }}</p>
          </div>
          <div>
            <span class="px-2 py-1 rounded text-xs font-medium"
                  [ngClass]="(invProductoSeleccionado.cantidadStock || 0) <= (invProductoSeleccionado.stockMinimo || 0) ? 'bg-red-100 text-red-700' : 'bg-green-100 text-green-700'">
              {{ (invProductoSeleccionado.cantidadStock || 0) <= (invProductoSeleccionado.stockMinimo || 0) ? 'CRÍTICO' : 'OK' }}
            </span>
          </div>
        </div>
        <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mt-3">
          <div class="p-3 bg-white rounded border">
            <p class="text-xs text-gray-500">Stock actual</p>
            <p class="text-lg font-semibold">{{ invProductoSeleccionado.cantidadStock || 0 | number:'1.0-2' }} {{ invProductoSeleccionado.unidadMedida }}</p>
          </div>
          <div class="p-3 bg-white rounded border">
            <p class="text-xs text-gray-500">Stock mínimo</p>
            <p class="text-lg">{{ getStockMinimoProductoSeleccionado() | number:'1.0-2' }} {{ invProductoSeleccionado.unidadMedida || getUnidadBaseProducto(selectedProductIdEntradas) }}</p>
          </div>
          <div class="p-3 bg-white rounded border">
            <p class="text-xs text-gray-500">Costo unitario promedio</p>
            <p class="text-lg">{{ invProductoSeleccionado.costoUnitarioPromedio || 0 | number:'1.2-4' }}</p>
          </div>
          <div class="p-3 bg-white rounded border">
            <p class="text-xs text-gray-500">Actualizado</p>
            <p class="text-lg">{{ invProductoSeleccionado.updateDate ? (toDate(invProductoSeleccionado.updateDate) | date:'dd/MM/yyyy') : '-' }}</p>
          </div>
        </div>
      </div>

      <form [formGroup]="entradaForm" (ngSubmit)="crearEntrada()" class="grid grid-cols-1 md:grid-cols-3 gap-4">
        <input type="hidden" formControlName="productId">
        <div>
          <label class="text-sm font-medium text-gray-700">Contenido por unidad (base)
            <span class="text-gray-500">[{{ getUnidadBaseProducto(selectedProductIdEntradas) }}]</span>
          </label>
          <input type="number" step="0.001" formControlName="contenidoPorUnidadBase" class="w-full p-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500" placeholder="ej: 50 (ml) o 1 (kg)">
        </div>
        <div>
          <label class="text-sm font-medium text-gray-700">Cantidad de unidades</label>
          <input type="number" step="0.001" formControlName="cantidadUnidades" class="w-full p-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500">
        </div>
        <div>
          <label class="text-sm font-medium text-gray-700">Código de lote</label>
          <input type="text" formControlName="codigoLote" class="w-full p-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500">
        </div>
        <div class="md:col-span-3 text-sm text-gray-600">
          Total base calculado: 
          <span class="font-semibold">{{ getTotalBaseCalculado() | number:'1.0-3' }} {{ getUnidadBaseProducto(selectedProductIdEntradas) }}</span>
        </div>
        <div>
          <label class="text-sm font-medium text-gray-700">Fecha ingreso</label>
          <input type="date" formControlName="fechaIngreso" class="w-full p-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500">
        </div>
        <div>
          <label class="text-sm font-medium text-gray-700">Fecha vencimiento</label>
          <input type="date" formControlName="fechaVencimiento" class="w-full p-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500">
        </div>
        <div>
          <label class="text-sm font-medium text-gray-700">Observaciones</label>
          <input type="text" formControlName="observaciones" class="w-full p-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500">
        </div>
        <div>
          <label class="text-sm font-medium text-gray-700">Proveedor</label>
          <select formControlName="providerId" class="w-full p-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500">
            <option [ngValue]="null">Seleccione un proveedor</option>
            <option *ngFor="let prov of providers" [ngValue]="prov.id">{{ prov.name }}</option>
          </select>
        </div>
        <div>
          <label class="text-sm font-medium text-gray-700">Costo unitario (base)</label>
          <input type="number" step="0.0001" formControlName="costoUnitarioBase" class="w-full p-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500" placeholder="ej: costo por kg/ml">
        </div>
        <div>
          <label class="text-sm font-medium text-gray-700">Costo por unidad de control</label>
          <input type="number" step="0.0001" formControlName="costoPorUnidadControl" class="w-full p-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500" placeholder="opcional: costo por saco/frasco">
        </div>
        <div class="md:col-span-3 flex justify-end">
          <button type="submit" [disabled]="entradaForm.invalid || !selectedProductIdEntradas" class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors disabled:bg-gray-400 disabled:cursor-not-allowed">
            Crear Entrada
          </button>
        </div>
      </form>
    </div>

    <div class="bg-white border border-gray-200 rounded-lg p-6 shadow-sm" *ngIf="selectedProductIdEntradas">
      <h3 class="text-lg font-semibold text-gray-800 mb-4">
        <i class="fas fa-list mr-2 text-indigo-600"></i>Entradas del producto seleccionado
      </h3>
      <div class="overflow-x-auto">
        <table class="min-w-full divide-y divide-gray-200">
          <thead class="bg-gray-50">
            <tr>
              <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Lote</th>
              <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Ingreso</th>
              <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Vence</th>
              <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Stock base</th>
              <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Unidades</th>
              <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Unidad ctrl</th>
              <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Proveedor</th>
              <th class="px-4 py-2 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Costo base</th>
              <th class="px-4 py-2 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Costo x unidad ctrl</th>
              <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Estado</th>
              <th class="px-4 py-2 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">Acciones</th>
            </tr>
          </thead>
          <tbody class="bg-white divide-y divide-gray-200">
            <tr *ngFor="let e of entradasProducto">
              <td class="px-4 py-2">{{ e.codigoLote || '-' }}</td>
              <td class="px-4 py-2">{{ e.fechaIngreso ? (toDate(e.fechaIngreso) | date:'dd/MM/yyyy') : '-' }}</td>
              <td class="px-4 py-2">{{ e.fechaVencimiento ? (toDate(e.fechaVencimiento) | date:'MM/yyyy') : '-' }}</td>
              <td class="px-4 py-2">{{ e.stockBaseRestante || 0 | number:'1.0-2' }}</td>
              <td class="px-4 py-2">{{ e.stockUnidadesRestantes || 0 | number:'1.0-2' }}</td>
              <td class="px-4 py-2">{{ e.unidadControl || '-' }}</td>
              <td class="px-4 py-2">{{ e.provider?.name || '-' }}</td>
              <td class="px-4 py-2 text-right">{{ e.costoUnitarioBase || 0 | number:'1.2-4' }}</td>
              <td class="px-4 py-2 text-right">{{ e.costoPorUnidadControl || 0 | number:'1.2-4' }}</td>
              <td class="px-4 py-2">
                <span class="px-2 py-1 rounded-full text-xs font-semibold" [ngClass]="e.activo ? 'bg-green-100 text-green-700' : 'bg-gray-200 text-gray-700'">
                  {{ e.activo ? 'Vigente' : 'Cerrada' }}
                </span>
              </td>
              <td class="px-4 py-2 text-center">
                <div class="flex justify-center space-x-2">
                  <button (click)="openEditEntrada(e)" class="text-blue-600 hover:text-blue-800 p-1 rounded hover:bg-blue-50" title="Editar entrada">
                    <i class="fas fa-edit"></i>
                  </button>
                  <button (click)="eliminarEntrada(e)" class="text-red-600 hover:text-red-800 p-1 rounded hover:bg-red-50" title="Eliminar (soft delete)">
                    <i class="fas fa-trash"></i>
                  </button>
                </div>
              </td>
            </tr>
            <tr *ngIf="entradasProducto.length === 0">
              <td colspan="11" class="px-4 py-4 text-center text-sm text-gray-500">No hay entradas para el producto seleccionado</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>

<!-- Modal edición de entrada -->
<div *ngIf="showEditEntradaModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
  <div class="bg-white rounded-lg shadow-xl w-full max-w-2xl">
    <div class="p-6">
      <div class="flex justify-between items-center mb-4">
        <h3 class="text-lg font-semibold text-gray-900">Editar Entrada</h3>
        <button (click)="closeEditEntrada()" class="text-gray-500 hover:text-gray-700">
          <i class="fas fa-times"></i>
        </button>
      </div>
      <form [formGroup]="editEntradaForm" (ngSubmit)="saveEditEntrada()" class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <div>
          <label class="text-sm font-medium text-gray-700">Código de lote</label>
          <input type="text" formControlName="codigoLote" class="w-full p-2 border rounded-md" />
        </div>
        <div>
          <label class="text-sm font-medium text-gray-700">Unidad de control</label>
          <input type="text" formControlName="unidadControl" class="w-full p-2 border rounded-md" />
        </div>
        <div>
          <label class="text-sm font-medium text-gray-700">Fecha ingreso</label>
          <input type="date" formControlName="fechaIngreso" class="w-full p-2 border rounded-md" />
        </div>
        <div>
          <label class="text-sm font-medium text-gray-700">Fecha vencimiento</label>
          <input type="date" formControlName="fechaVencimiento" class="w-full p-2 border rounded-md" />
        </div>
        <div>
          <label class="text-sm font-medium text-gray-700">Contenido por unidad (base)
            <span class="text-gray-500">[{{ getUnidadBaseProducto(selectedProductIdEntradas) }}]</span>
          </label>
          <input type="number" step="0.001" formControlName="contenidoPorUnidadBase" class="w-full p-2 border rounded-md" />
        </div>
        <div>
          <label class="text-sm font-medium text-gray-700">Cantidad de unidades</label>
          <input type="number" step="0.001" formControlName="cantidadUnidades" class="w-full p-2 border rounded-md" />
        </div>
        <div class="md:col-span-2">
          <label class="text-sm font-medium text-gray-700">Observaciones</label>
          <input type="text" formControlName="observaciones" class="w-full p-2 border rounded-md" />
        </div>
        <div>
          <label class="text-sm font-medium text-gray-700">Proveedor</label>
          <select formControlName="providerId" class="w-full p-2 border rounded-md">
            <option [ngValue]="null">Sin proveedor</option>
            <option *ngFor="let prov of providers" [ngValue]="prov.id">{{ prov.name }}</option>
          </select>
        </div>
        <div>
          <label class="text-sm font-medium text-gray-700">Costo unitario (base)</label>
          <input type="number" step="0.0001" formControlName="costoUnitarioBase" class="w-full p-2 border rounded-md" />
        </div>
        <div>
          <label class="text-sm font-medium text-gray-700">Costo por unidad de control</label>
          <input type="number" step="0.0001" formControlName="costoPorUnidadControl" class="w-full p-2 border rounded-md" />
        </div>
        <div class="md:col-span-2 flex justify-end space-x-3 mt-2">
          <button type="button" (click)="closeEditEntrada()" class="px-4 py-2 bg-gray-200 text-gray-700 rounded-md hover:bg-gray-300">Cancelar</button>
          <button type="submit" class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700">Guardar</button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- Vista de Inventario Automático - NUEVA FUNCIONALIDAD -->
<div *ngIf="vistaActual === 'inventario-automatico'">
  <div class="space-y-6">
    <!-- Título de la sección -->
    <div class="text-center">
      <h2 class="text-2xl font-bold text-gray-800 mb-2">
        <i class="fas fa-warehouse text-blue-600 mr-2"></i>
        Inventario Automático con Control de Stock
      </h2>
      <p class="text-gray-600">
        Seguimiento en tiempo real de la disminución automática de productos según consumo por lotes
      </p>
    </div>

    <!-- Alertas de Stock Bajo -->
    <div *ngIf="inventariosStockBajo.length > 0" class="bg-red-50 border-l-4 border-red-500 p-4 rounded-r-lg shadow-sm">
      <div class="flex items-center">
        <div class="flex-shrink-0">
          <i class="fas fa-exclamation-triangle text-red-500 text-xl"></i>
        </div>
        <div class="ml-3">
          <h3 class="text-lg font-medium text-red-800">
            ⚠️ Alertas de Stock Bajo ({{ inventariosStockBajo.length }})
          </h3>
          <div class="mt-2 text-sm text-red-700">
            <ul class="list-disc list-inside">
              <li *ngFor="let item of inventariosStockBajo">
                <strong>{{ item.tipoAlimento.name }}</strong>: 
                {{ item.cantidadStock }} {{ item.unidadMedida }} 
                (Mínimo: {{ item.stockMinimo }} {{ item.unidadMedida }})
              </li>
            </ul>
          </div>
        </div>
      </div>
    </div>

    <!-- Resumen de Inventario -->
    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
      <div class="bg-gradient-to-r from-blue-500 to-blue-600 text-white rounded-lg p-6 shadow-lg">
        <div class="flex items-center justify-between">
          <div>
            <p class="text-blue-100 text-sm font-medium">Total Productos</p>
            <p class="text-3xl font-bold">{{ inventarioAlimentos.length }}</p>
          </div>
          <div class="p-3 bg-blue-400 rounded-full">
            <i class="fas fa-boxes text-white text-2xl"></i>
          </div>
        </div>
      </div>
      
      <div class="bg-gradient-to-r from-green-500 to-green-600 text-white rounded-lg p-6 shadow-lg">
        <div class="flex items-center justify-between">
          <div>
            <p class="text-green-100 text-sm font-medium">Stock Normal</p>
            <p class="text-3xl font-bold">
              {{ contarInventariosPorEstado('NORMAL') }}
            </p>
          </div>
          <div class="p-3 bg-green-400 rounded-full">
            <i class="fas fa-check-circle text-white text-2xl"></i>
          </div>
        </div>
      </div>
      
      <div class="bg-gradient-to-r from-red-500 to-red-600 text-white rounded-lg p-6 shadow-lg">
        <div class="flex items-center justify-between">
          <div>
            <p class="text-red-100 text-sm font-medium">Stock Crítico</p>
            <p class="text-3xl font-bold">{{ inventariosStockBajo.length }}</p>
          </div>
          <div class="p-3 bg-red-400 rounded-full">
            <i class="fas fa-exclamation-triangle text-white text-2xl"></i>
          </div>
        </div>
      </div>
    </div>

    <!-- Mensaje cuando no hay inventarios -->
    <div *ngIf="inventarioAlimentos.length === 0" class="bg-yellow-50 border-l-4 border-yellow-500 p-6 rounded-r-lg shadow-sm text-center">
      <div class="flex flex-col items-center">
        <i class="fas fa-exclamation-triangle text-yellow-500 text-3xl mb-4"></i>
        <h3 class="text-lg font-medium text-yellow-800 mb-2">
          No se encontraron datos de inventario
        </h3>
        <p class="text-yellow-700 mb-4">
          Parece que el inventario automático no tiene datos. Esto puede suceder si:
        </p>
        <ul class="text-yellow-700 text-left mb-6">
          <li class="mb-1">• Es la primera vez que usa el sistema</li>
          <li class="mb-1">• No se han registrado productos en el inventario</li>
          <li class="mb-1">• Hay un problema de conexión con el backend</li>
        </ul>
        <div class="flex space-x-4">
          <button 
            (click)="crearDatosEjemplo()" 
            class="bg-yellow-600 hover:bg-yellow-700 text-white px-6 py-3 rounded-lg font-medium transition-colors duration-200 shadow-md">
            <i class="fas fa-database mr-2"></i>
            Crear Datos de Ejemplo
          </button>
          <button 
            (click)="cargarInventarioAutomatico()" 
            class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg font-medium transition-colors duration-200 shadow-md">
            <i class="fas fa-sync-alt mr-2"></i>
            Reintentar Carga
          </button>
        </div>
      </div>
    </div>

    <!-- Tabla de Inventario con Disminución Automática -->
    <div *ngIf="inventarioAlimentos.length > 0" class="bg-white rounded-lg shadow-md overflow-hidden">
      <div class="px-6 py-4 bg-gray-50 border-b border-gray-200">
        <h3 class="text-lg font-semibold text-gray-800">
          <i class="fas fa-chart-bar text-blue-600 mr-2"></i>
          Control de Stock en Tiempo Real
        </h3>
        <p class="text-sm text-gray-600 mt-1">
          Los valores se actualizan automáticamente cuando se registra consumo de alimentos en los lotes
        </p>
      </div>
      
      <div class="overflow-x-auto">
        <table class="min-w-full divide-y divide-gray-200">
          <thead class="bg-gray-50">
            <tr>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                Producto
              </th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                Stock Original
              </th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                Stock Actual
              </th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                Consumido
              </th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                Stock Mínimo
              </th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                Estado
              </th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                Progreso
              </th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                Acciones
              </th>
            </tr>
          </thead>
          <tbody class="bg-white divide-y divide-gray-200">
            <tr *ngFor="let inventario of inventarioAlimentos" class="hover:bg-gray-50">
              <td class="px-6 py-4 whitespace-nowrap">
                <div class="flex items-center">
                  <div class="flex-shrink-0 h-10 w-10">
                    <div class="h-10 w-10 rounded-full bg-blue-100 flex items-center justify-center">
                      <i class="fas fa-cube text-blue-600"></i>
                    </div>
                  </div>
                  <div class="ml-4">
                    <div class="text-sm font-medium text-gray-900" [title]="getNombresProductosPorTipo(inventario, 10)">
                      {{ getNombresProductosPorTipo(inventario) }}
                    </div>
                    <div class="text-sm text-gray-500">
                      Categoría: Alimento • Tipo: {{ inventario.tipoAlimento.name }}
                    </div>
                  </div>
                </div>
              </td>
              <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900" title="Cantidad inicial registrada al crear el producto (consolidado por tipo)">
                <span class="font-semibold text-blue-600">
                  {{ getStockOriginalPorTipo(inventario) || 'N/A' }}
                </span>
                <span class="text-gray-500 ml-1">{{ inventario.unidadMedida }}</span>
              </td>
              <td class="px-6 py-4 whitespace-nowrap text-sm" title="Se actualiza automáticamente con consumos de lotes (stock válido, sin vencidos)">
                <span class="font-bold" [ngClass]="{
                  'text-red-600': getEstadoStock(inventario) === 'CRÍTICO',
                  'text-yellow-600': getEstadoStock(inventario) === 'BAJO',
                  'text-green-600': getEstadoStock(inventario) === 'NORMAL'
                }">
                  {{ getStockActualPorTipo(inventario) }}
                </span>
                <span class="text-gray-500 ml-1">{{ inventario.unidadMedida }}</span>
              </td>
              <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900" title="Consumo acumulado registrado por lotes (SALIDA/CONSUMO_LOTE)">
                <span class="font-semibold text-orange-600">
                  {{ getConsumidoPorTipo(inventario) }}
                </span>
                <span class="text-gray-500 ml-1">{{ inventario.unidadMedida }}</span>
              </td>
              <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900" title="Umbral configurado al registrar el producto (consolidado por tipo)">
                <span class="font-medium text-purple-600">
                  {{ getStockMinimoPorTipo(inventario) }}
                </span>
                <span class="text-gray-500 ml-1">{{ inventario.unidadMedida }}</span>
              </td>
              <td class="px-6 py-4 whitespace-nowrap">
                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium"
                      [ngClass]="{
                        'bg-red-100 text-red-800': getEstadoStock(inventario) === 'CRÍTICO',
                        'bg-yellow-100 text-yellow-800': getEstadoStock(inventario) === 'BAJO',
                        'bg-green-100 text-green-800': getEstadoStock(inventario) === 'NORMAL'
                      }">
                  {{ getEstadoStock(inventario) }}
                </span>
              </td>
              <td class="px-6 py-4 whitespace-nowrap">
                <div class="w-full bg-gray-200 rounded-full h-2.5">
                  <div class="h-2.5 rounded-full transition-all duration-300"
                       [ngClass]="getColorStock(inventario)"
                       [style.width.%]="calcularPorcentajeStock(inventario)">
                  </div>
                </div>
                <div class="text-xs text-gray-500 mt-1">
                  {{ calcularPorcentajeStock(inventario) }}% disponible
                </div>
              </td>
              <td class="px-6 py-4 whitespace-nowrap text-sm text-center">
                <div class="flex justify-center space-x-2">
                  <button 
                    (click)="verMovimientos(inventario)" 
                    class="text-blue-600 hover:text-blue-900 p-2 rounded-full hover:bg-blue-100 transition-colors"
                    title="Ver historial de movimientos">
                    <i class="fas fa-history"></i>
                  </button>
                </div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <!-- Botones de acción -->
    <div class="flex justify-center space-x-4">
      <button 
        (click)="cargarInventarioAutomatico()" 
        class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg font-medium transition-colors duration-200 shadow-md">
        <i class="fas fa-sync-alt mr-2"></i>
        Actualizar Inventario
      </button>
      
      <!-- Botón de datos de ejemplo (solo visible cuando hay pocos inventarios) -->
      <button 
        *ngIf="inventarioAlimentos.length < 3"
        (click)="crearDatosEjemplo()" 
        class="bg-green-600 hover:bg-green-700 text-white px-6 py-3 rounded-lg font-medium transition-colors duration-200 shadow-md">
        <i class="fas fa-plus mr-2"></i>
        Agregar Datos de Ejemplo
      </button>
    </div>
  </div>
</div>