<h2>{{ id ? 'Editar producto' : 'Nuevo producto' }}</h2>

<form [formGroup]="form" (ngSubmit)="guardar()" class="form">
  <mat-form-field appearance="outline">
    <mat-label>Nombre (catálogo)</mat-label>
    <mat-select formControlName="nombreProductoId" (selectionChange)="setNameFromCatalog($event.value)">
      <mat-option *ngFor="let np of nombreProductos" [value]="np.id">{{ np.nombre }}</mat-option>
    </mat-select>
    <mat-hint>Seleccione un nombre para autocompletar</mat-hint>
  </mat-form-field>

  <mat-form-field appearance="outline">
    <mat-label>Nombre</mat-label>
    <input matInput formControlName="name" required />
    <mat-error *ngIf="form.get('name')?.hasError('required')">Requerido</mat-error>
  </mat-form-field>

  <mat-form-field appearance="outline">
    <mat-label>Proveedor</mat-label>
    <mat-select formControlName="provider_id" required>
      <mat-option *ngFor="let p of providers" [value]="p.id">{{ p.name }}</mat-option>
    </mat-select>
    <mat-error *ngIf="form.get('provider_id')?.hasError('required')">Requerido</mat-error>
  </mat-form-field>

  <mat-form-field appearance="outline">
    <mat-label>Tipo de alimento</mat-label>
    <mat-select formControlName="typeFood_id" required>
      <mat-option *ngFor="let t of typeFoods" [value]="t.id">{{ t.name }}</mat-option>
    </mat-select>
    <mat-error *ngIf="form.get('typeFood_id')?.hasError('required')">Requerido</mat-error>
  </mat-form-field>

  <mat-form-field appearance="outline">
    <mat-label>Unidad de medida</mat-label>
    <mat-select formControlName="unitMeasurement_id" required>
      <mat-option *ngFor="let u of unitMeasurements" [value]="u.id">{{ u.name }} {{ u.name_short ? '(' + u.name_short + ')' : '' }}</mat-option>
    </mat-select>
    <mat-error *ngIf="form.get('unitMeasurement_id')?.hasError('required')">Requerido</mat-error>
  </mat-form-field>

  <mat-form-field appearance="outline">
    <mat-label>Animal</mat-label>
    <mat-select formControlName="animal_id" required>
      <mat-option *ngFor="let a of animals" [value]="a.id">{{ a.name }}</mat-option>
    </mat-select>
    <mat-error *ngIf="form.get('animal_id')?.hasError('required')">Requerido</mat-error>
  </mat-form-field>

  <mat-form-field appearance="outline">
    <mat-label>Etapa</mat-label>
    <mat-select formControlName="stage_id" required>
      <mat-option *ngFor="let s of stages" [value]="s.id">{{ s.name }}</mat-option>
    </mat-select>
    <mat-error *ngIf="form.get('stage_id')?.hasError('required')">Requerido</mat-error>
  </mat-form-field>

  <mat-form-field appearance="outline">
    <mat-label>Cantidad</mat-label>
    <input matInput type="number" formControlName="quantity" />
  </mat-form-field>

  <mat-form-field appearance="outline">
    <mat-label>Precio unitario</mat-label>
    <input matInput type="number" formControlName="price_unit" />
  </mat-form-field>

  <mat-form-field appearance="outline">
    <mat-label>N° factura</mat-label>
    <input matInput type="number" formControlName="number_facture" />
  </mat-form-field>

  <mat-form-field appearance="outline">
    <mat-label>Nivel mínimo</mat-label>
    <input matInput type="number" formControlName="level_min" />
  </mat-form-field>

  <mat-form-field appearance="outline">
    <mat-label>Nivel máximo</mat-label>
    <input matInput type="number" formControlName="level_max" />
  </mat-form-field>

  <div class="actions">
    <button mat-stroked-button type="button" (click)="cancelar()">Cancelar</button>
    <button mat-raised-button color="primary" type="submit" [disabled]="form.invalid || loading">
      {{ loading ? 'Guardando...' : 'Guardar' }}
    </button>
  </div>
</form>
