<!-- Header de la página -->
<div style="padding: 20px; background: #f0f4f8; min-height: 100vh;">
  <h1 style="font-size: 32px; margin-bottom: 10px;">🐷 Gestión de Lotes</h1>
  <p style="color: #666; margin-bottom: 20px;">Control de consumo por lote</p>
  
  <!-- Botón temporal de debug -->
  <div style="margin-bottom: 20px;">
    <button (click)="debugBackendConnection()" 
            style="background: #dc2626; color: white; padding: 8px 16px; border: none; border-radius: 6px; cursor: pointer; font-size: 14px;">
      🔧 DEBUG: Probar Backend
    </button>
    <span style="margin-left: 10px; font-size: 12px; color: #666;">
      Abre DevTools → Console para ver logs detallados
    </span>
  </div>

  <!-- Lista de Lotes estilo React -->
  <div *ngFor="let lote of lotesFiltrados; trackBy: trackByLote" 
       style="background: white; border-radius: 12px; margin-bottom: 20px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
    
    <!-- Header del lote (clickeable) -->
    <div (click)="toggleExpand(lote)"
         style="background: #4a5568; color: white; padding: 20px; border-radius: 12px 12px 0 0; cursor: pointer;">
      <h2 style="font-size: 24px; margin: 0;">{{ lote.codigo }} - {{ lote.name }}</h2>
      <p style="margin: 5px 0 0 0; opacity: 0.9;">
        {{ lote.quantity }} animales - Total: {{ getConsumoTotal(lote) | number:'1.2-2' }} kg
      </p>
    </div>

    <!-- Contenido expandible -->
    <div *ngIf="isExpanded(lote)" style="padding: 20px;">
      <!-- KPIs principales -->
      <div style="display: flex; gap: 10px; margin-bottom: 20px; flex-wrap: wrap;">
        <!-- Consumo Total -->
        <div style="flex: 1; background: #dbeafe; padding: 20px; border-radius: 10px; border: 2px solid #93c5fd;">
          <div style="font-size: 14px; margin-bottom: 5px;">Consumo Total</div>
          <div style="font-size: 32px; font-weight: bold;">{{ getConsumoTotal(lote) | number:'1.2-2' }}</div>
          <div style="font-size: 12px; margin-top: 5px;">kilogramos</div>
        </div>

        <!-- Animales -->
        <div style="flex: 1; background: #dcfce7; padding: 20px; border-radius: 10px; border: 2px solid #86efac;">
          <div style="font-size: 14px; margin-bottom: 5px;">Animales</div>
          <div style="font-size: 32px; font-weight: bold;">{{ lote.quantity }}</div>
          <div style="font-size: 12px; margin-top: 5px;">cabezas</div>
        </div>

        <!-- Promedio -->
        <div style="flex: 1; background: #f3e8ff; padding: 20px; border-radius: 10px; border: 2px solid #d8b4fe;">
          <div style="font-size: 14px; margin-bottom: 5px;">Promedio</div>
          <div style="font-size: 32px; font-weight: bold;">{{ getPromedioPorAnimal(lote) | number:'1.2-2' }}</div>
          <div style="font-size: 12px; margin-top: 5px;">kg/animal</div>
        </div>

        <!-- KPI por producto (primeros 3) -->
        <ng-container *ngFor="let producto of getProductosDelLote(lote) | slice:0:3; let i = index">
          <div [ngStyle]="getKPIStyle(producto.nombre, i)" 
               style="flex: 1; padding: 20px; border-radius: 10px;">
            <div style="font-size: 14px; margin-bottom: 5px; font-weight: 600; opacity: .9;">{{ producto.nombre }}</div>
            <div style="font-size: 32px; font-weight: bold;">{{ producto.cantidad | number:'1.2-2' }}</div>
            <div style="font-size: 12px; margin-top: 5px;">kilogramos</div>
            <div style="background: rgba(255,255,255,.5); height: 8px; border-radius: 10px; margin-top: 10px;">
              <div [style.width.%]="getPorcentajeProducto(lote, producto)" 
                   style="height: 8px; border-radius: 10px; background: rgba(16,185,129,.8);"></div>
            </div>
          </div>
        </ng-container>
      </div>

      <!-- Tipos de Alimento (KPI por producto) -->
      <h3 style="margin-top: 30px; margin-bottom: 15px;">Tipos de Alimento</h3>
      <div *ngIf="getProductosDelLote(lote)?.length; else sinAlimentos" 
           style="display: flex; flex-wrap: wrap; gap: 10px; margin-bottom: 10px;">
        <div *ngFor="let producto of getProductosDelLote(lote); let i = index" 
             [ngStyle]="getKPIStyle(producto.nombre, i)"
             style="flex: 1 1 220px; padding: 20px; border-radius: 10px;">
          <div style="font-size: 14px; margin-bottom: 5px; font-weight: 600; opacity: .9;">
            {{ producto.nombre | uppercase }}
          </div>
          <div style="font-size: 28px; font-weight: bold;">{{ producto.cantidad | number:'1.2-2' }} kg</div>
          <div style="background: #e5e7eb; height: 8px; border-radius: 10px; margin-top: 10px;">
            <div [style.width.%]="getPorcentajeProducto(lote, producto)"
                 style="height: 8px; border-radius: 10px; background: #3b82f6;"></div>
          </div>
          <div style="font-size: 12px; margin-top: 5px;">{{ getPorcentajeProducto(lote, producto) }}% del total</div>
        </div>
      </div>
      
      <ng-template #sinAlimentos>
        <div style="background: #f9fafb; padding: 15px; border-radius: 10px; margin-bottom: 10px; border: 1px solid #e5e7eb; text-align: center; color: #666;">
          No hay registros de alimentos para este lote
        </div>
      </ng-template>

      <!-- Historial -->
      <h3 style="margin-top: 30px; margin-bottom: 15px;">Historial</h3>
      
      <div *ngIf="getRegistrosDelLote(lote)?.length; else sinHistorial">
        <table style="width: 100%; border-collapse: collapse;">
          <thead>
            <tr style="background: #f9fafb;">
              <th style="padding: 12px; text-align: left; font-size: 12px;">FECHA</th>
              <th style="padding: 12px; text-align: left; font-size: 12px;">TIPO</th>
              <th style="padding: 12px; text-align: left; font-size: 12px;">CANTIDAD</th>
              <th style="padding: 12px; text-align: left; font-size: 12px;">RESPONSABLE</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let registro of getRegistrosDelLote(lote) | slice:0:5">
              <td style="padding: 12px; border-top: 1px solid #e5e7eb;">{{ registro.fecha | date:'yyyy-MM-dd HH:mm' }}</td>
              <td style="padding: 12px; border-top: 1px solid #e5e7eb;">{{ getNombreProductoRegistro(registro) }}</td>
              <td style="padding: 12px; border-top: 1px solid #e5e7eb;">{{ registro.cantidad | number:'1.2-2' }} kg</td>
              <td style="padding: 12px; border-top: 1px solid #e5e7eb;">{{ registro.usuarioNombre || 'Sistema' }}</td>
            </tr>
          </tbody>
        </table>
      </div>
      
      <ng-template #sinHistorial>
        <div style="background: #f9fafb; padding: 15px; border-radius: 10px; border: 1px solid #e5e7eb; text-align: center; color: #666;">
          No hay registros de historial para este lote
        </div>
      </ng-template>
    </div>
  </div>
</div> 
